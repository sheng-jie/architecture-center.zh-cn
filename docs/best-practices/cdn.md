---
title: "内容交付网络指南"
description: "有关使用内容交付网络 (CDN) 传送 Azure 中托管的高带宽内容的指南。"
author: dragon119
ms.date: 02/02/2018
pnp.series.title: Best Practices
ms.openlocfilehash: 42b73db08ecef858f5279ea292cf8c0df77b847c
ms.sourcegitcommit: 29fbcb1eec44802d2c01b6d3bcf7d7bd0bae65fc
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 02/27/2018
---
# <a name="best-practices-for-using-content-delivery-networks-cdns"></a><span data-ttu-id="09cd2-103">使用内容交付网络 (CDN) 的最佳做法</span><span class="sxs-lookup"><span data-stu-id="09cd2-103">Best practices for using content delivery networks (CDNs)</span></span>

<span data-ttu-id="09cd2-104">内容交付网络 (CDN) 是高效地向用户交付 Web 内容的分布式服务器网络。</span><span class="sxs-lookup"><span data-stu-id="09cd2-104">A content delivery network (CDN) is a distributed network of servers that can efficiently deliver web content to users.</span></span> <span data-ttu-id="09cd2-105">CDN 将缓存的内容存储在靠近最终用户的边缘服务器上，以最大程度地降低延迟。</span><span class="sxs-lookup"><span data-stu-id="09cd2-105">CDNs store cached content on edge servers that are close to end-users, to minimize latency.</span></span> 

<span data-ttu-id="09cd2-106">CDN 通常用来交付静态内容，例如图像、样式表、文档、客户端脚本和 HTML 页面。</span><span class="sxs-lookup"><span data-stu-id="09cd2-106">CDNs are typically used to deliver static content such as images, style sheets, documents, client-side scripts, and HTML pages.</span></span> <span data-ttu-id="09cd2-107">使用 CDN 的主要优点是延迟较低且能更快地将内容交付给用户，而与托管应用程序的数据中心的地理位置无关。</span><span class="sxs-lookup"><span data-stu-id="09cd2-107">The major advantages of using a CDN are lower latency and faster delivery of content to users, regardless of their geographical location in relation to the datacenter where the application is hosted.</span></span> <span data-ttu-id="09cd2-108">CDN 还可以帮助降低 Web 应用程序上的负载，因为应用程序不需要为对 CDN 中托管的内容发出的请求提供服务。</span><span class="sxs-lookup"><span data-stu-id="09cd2-108">CDNs can also help to reduce load on a web application, because the application does not have to service requests for the content that is hosted in the CDN.</span></span>
 
![CDN 示意图](./images/cdn/CDN.png)

<span data-ttu-id="09cd2-110">在 Azure 中，[Azure 内容交付网络](/azure/cdn/cdn-overview)是一个全局 CDN 解决方案，用于交付在 Azure 中或在任何其他位置中托管的高带宽内容。</span><span class="sxs-lookup"><span data-stu-id="09cd2-110">In Azure, the [Azure Content Delivery Network](/azure/cdn/cdn-overview) is a global CDN solution for delivering high-bandwidth content that is hosted in Azure or any other location.</span></span> <span data-ttu-id="09cd2-111">使用 Azure CDN，可以缓存从 Azure Blob 存储、Web 应用程序、虚拟机、任何可公开访问的 Web 服务器加载的公开可用对象。</span><span class="sxs-lookup"><span data-stu-id="09cd2-111">Using Azure CDN, you can cache publicly available objects loaded from Azure blob storage, a web application, virtual machine, any publicly accessible web server.</span></span> 

<span data-ttu-id="09cd2-112">本主题介绍了使用 CDN 时的一些常规最佳做法和注意事项。</span><span class="sxs-lookup"><span data-stu-id="09cd2-112">This topic describes some general best practices and considerations when using a CDN.</span></span> <span data-ttu-id="09cd2-113">若要了解有关使用 Azure CDN 的详细信息，请参阅 [CDN 文档](/azure/cdn/)。</span><span class="sxs-lookup"><span data-stu-id="09cd2-113">To learn more about using Azure CDN, see [CDN Documentation](/azure/cdn/).</span></span>

## <a name="how-and-why-a-cdn-is-used"></a><span data-ttu-id="09cd2-114">如何和为何使用 CDN</span><span class="sxs-lookup"><span data-stu-id="09cd2-114">How and why a CDN is used</span></span>

<span data-ttu-id="09cd2-115">CDN 的典型用途包括：</span><span class="sxs-lookup"><span data-stu-id="09cd2-115">Typical uses for a CDN include:</span></span>  

* <span data-ttu-id="09cd2-116">传送客户端应用程序的静态资源，通常来自网站。</span><span class="sxs-lookup"><span data-stu-id="09cd2-116">Delivering static resources for client applications, often from a website.</span></span> <span data-ttu-id="09cd2-117">这些资源可以是图像、样式表、文档、文件、客户端脚本、HTML 页面、HTML 片段，或服务器无需为每个请求修改的任何其他内容。</span><span class="sxs-lookup"><span data-stu-id="09cd2-117">These resources can be images, style sheets, documents, files, client-side scripts, HTML pages, HTML fragments, or any other content that the server does not need to modify for each request.</span></span> <span data-ttu-id="09cd2-118">应用程序可以在运行时创建项，并让 CDN 使用它们（例如，通过创建当前头条新闻列表），但不会为每个请求都这么做。</span><span class="sxs-lookup"><span data-stu-id="09cd2-118">The application can create items at runtime and make them available to the CDN (for example, by creating a list of current news headlines), but it does not do so for each request.</span></span>
* <span data-ttu-id="09cd2-119">将公共静态内容和共享内容传送给设备，例如移动电话和平板电脑。</span><span class="sxs-lookup"><span data-stu-id="09cd2-119">Delivering public static and shared content to devices such as mobile phones and tablet computers.</span></span> <span data-ttu-id="09cd2-120">应用程序本身是一个 Web 服务，可将 API 提供给不同设备上运行的客户端。</span><span class="sxs-lookup"><span data-stu-id="09cd2-120">The application itself is a web service that offers an API to clients running on the various devices.</span></span> <span data-ttu-id="09cd2-121">CDN 还可以通过 Web 服务传送静态数据集供客户端使用（也许用于生成客户端 UI）。</span><span class="sxs-lookup"><span data-stu-id="09cd2-121">The CDN can also deliver static datasets (via the web service) for the clients to use, perhaps to generate the client UI.</span></span> <span data-ttu-id="09cd2-122">例如，CDN 可用于分发 JSON 或 XML 文档。</span><span class="sxs-lookup"><span data-stu-id="09cd2-122">For example, the CDN could be used to distribute JSON or XML documents.</span></span>
* <span data-ttu-id="09cd2-123">让客户端使用仅包含公共静态内容的整个网站，而无需任何专用计算资源。</span><span class="sxs-lookup"><span data-stu-id="09cd2-123">Serving entire websites that consist of only public static content to clients, without requiring any dedicated compute resources.</span></span>
* <span data-ttu-id="09cd2-124">根据需要将视频文件流式传输到客户端。</span><span class="sxs-lookup"><span data-stu-id="09cd2-124">Streaming video files to the client on demand.</span></span> <span data-ttu-id="09cd2-125">视频可从提供 CDN 连接的全球数据中心获得低延迟和可靠连接的好处。</span><span class="sxs-lookup"><span data-stu-id="09cd2-125">Video benefits from the low latency and reliable connectivity available from the globally located datacenters that offer CDN connections.</span></span> <span data-ttu-id="09cd2-126">Microsoft Azure 媒体服务 (AMS) 与 Azure CDN 集成，向 CDN 直接传送内容以实现进一步的内容分发。</span><span class="sxs-lookup"><span data-stu-id="09cd2-126">Microsoft Azure Media Services (AMS) integrates with Azure CDN to deliver content directly to the CDN for further distribution.</span></span> <span data-ttu-id="09cd2-127">有关详细信息，请参阅[流式处理终结点概述](/azure/media-services/media-services-streaming-endpoints-overview)。</span><span class="sxs-lookup"><span data-stu-id="09cd2-127">For more information, see [Streaming endpoints overview](/azure/media-services/media-services-streaming-endpoints-overview).</span></span>
* <span data-ttu-id="09cd2-128">一般而言，这可以改善用户体验，特别是与托管应用程序的数据中心距离遥远的用户。</span><span class="sxs-lookup"><span data-stu-id="09cd2-128">Generally improving the experience for users, especially those located far from the datacenter hosting the application.</span></span> <span data-ttu-id="09cd2-129">否则，这些用户可能会遇到较高的延迟。</span><span class="sxs-lookup"><span data-stu-id="09cd2-129">These users might otherwise suffer higher latency.</span></span> <span data-ttu-id="09cd2-130">Web 应用程序中内容的总大小基本上都是静态的，使用 CDN 有助于保持性能和总体用户体验，同时无需将应用程序部署到多个数据中心。</span><span class="sxs-lookup"><span data-stu-id="09cd2-130">A large proportion of the total size of the content in a web application is often static, and using the CDN can help to maintain performance and overall user experience while eliminating the requirement to deploy the application to multiple data centers.</span></span> <span data-ttu-id="09cd2-131">有关 Azure CDN 节点位置的列表，请参阅 [Azure CDN POP 位置](/azure/cdn/cdn-pop-locations/)。</span><span class="sxs-lookup"><span data-stu-id="09cd2-131">For a list of Azure CDN node locations, see [Azure CDN POP Locations](/azure/cdn/cdn-pop-locations/).</span></span>
* <span data-ttu-id="09cd2-132">支持 IoT（物联网）解决方案。</span><span class="sxs-lookup"><span data-stu-id="09cd2-132">Supporting IoT (Internet of Things) solutions.</span></span> <span data-ttu-id="09cd2-133">IoT 解决方案中涉及的巨量设备和电器可能很容易压垮某个应用程序（如果该应用程序必须直接将固件更新分发给每个设备）。</span><span class="sxs-lookup"><span data-stu-id="09cd2-133">The huge numbers of devices and appliances involved in an IoT solution could easily overwhelm an application if it had to distribute firmware updates directly to each device.</span></span>
* <span data-ttu-id="09cd2-134">应对需求高峰和浪涌而无需缩放应用程序，避免增加后续运行成本。</span><span class="sxs-lookup"><span data-stu-id="09cd2-134">Coping with peaks and surges in demand without requiring the application to scale, avoiding the consequent increased running costs.</span></span> <span data-ttu-id="09cd2-135">例如，对于硬件设备（例如特定型号的路由器）或消费型设备（例如智能电视）发布操作系统更新时，如果数以百万的用户和设备在短期间内下载更新，则可能会根据需要生成庞大的高峰量。</span><span class="sxs-lookup"><span data-stu-id="09cd2-135">For example, when an update to an operating system is released for a hardware device such as a specific model of router, or for a consumer device such as a smart TV, there will be a huge peak in demand as it is downloaded by millions of users and devices over a short period.</span></span>

## <a name="challenges"></a><span data-ttu-id="09cd2-136">挑战</span><span class="sxs-lookup"><span data-stu-id="09cd2-136">Challenges</span></span>

<span data-ttu-id="09cd2-137">计划使用 CDN 时必须考虑到几个难题。</span><span class="sxs-lookup"><span data-stu-id="09cd2-137">There are several challenges to take into account when planning to use a CDN.</span></span>  

* <span data-ttu-id="09cd2-138">**部署**。</span><span class="sxs-lookup"><span data-stu-id="09cd2-138">**Deployment**.</span></span> <span data-ttu-id="09cd2-139">确定 CDN 从中提取内容的来源，以及是否需要将内容部署到多个存储系统。</span><span class="sxs-lookup"><span data-stu-id="09cd2-139">Decide the origin from which the CDN fetches the content, and whether you need to deploy the content in more than one storage system.</span></span> <span data-ttu-id="09cd2-140">请考虑用于部署静态内容和资源的流程。</span><span class="sxs-lookup"><span data-stu-id="09cd2-140">Take into account the process for deploying static content and resources.</span></span> <span data-ttu-id="09cd2-141">例如，可能需要执行单独的步骤才能将内容加载到 Azure Blob 存储中。</span><span class="sxs-lookup"><span data-stu-id="09cd2-141">For example, you may need to implement a separate step to load content into Azure blob storage.</span></span>
* <span data-ttu-id="09cd2-142">**版本控制和缓存控制**。</span><span class="sxs-lookup"><span data-stu-id="09cd2-142">**Versioning and cache-control**.</span></span> <span data-ttu-id="09cd2-143">考虑如何更新静态内容和部署新版本。</span><span class="sxs-lookup"><span data-stu-id="09cd2-143">Consider how you will update static content and deploy new versions.</span></span> <span data-ttu-id="09cd2-144">了解 CDN 如何执行缓存和生存时间 (TTL)。</span><span class="sxs-lookup"><span data-stu-id="09cd2-144">Understand how the CDN performs caching and time-to-live (TTL).</span></span> <span data-ttu-id="09cd2-145">对于 Azure CDN，请参阅[缓存工作原理](/azure/cdn/cdn-how-caching-works)。</span><span class="sxs-lookup"><span data-stu-id="09cd2-145">For Azure CDN, see [How caching works](/azure/cdn/cdn-how-caching-works).</span></span>
* <span data-ttu-id="09cd2-146">**测试**。</span><span class="sxs-lookup"><span data-stu-id="09cd2-146">**Testing**.</span></span> <span data-ttu-id="09cd2-147">在本地或在过渡环境中开发和测试应用程序时，很难对 CDN 设置执行本地测试。</span><span class="sxs-lookup"><span data-stu-id="09cd2-147">It can be difficult to perform local testing of your CDN settings when developing and testing an application locally or in a staging environment.</span></span>
* <span data-ttu-id="09cd2-148">**搜索引擎优化 (SEO)**。</span><span class="sxs-lookup"><span data-stu-id="09cd2-148">**Search engine optimization (SEO)**.</span></span> <span data-ttu-id="09cd2-149">使用 CDN 时，图像和文档等内容由不同的域提供。</span><span class="sxs-lookup"><span data-stu-id="09cd2-149">Content such as images and documents are served from a different domain when you use the CDN.</span></span> <span data-ttu-id="09cd2-150">这可能会影响此内容的 SEO。</span><span class="sxs-lookup"><span data-stu-id="09cd2-150">This can have an effect on SEO for this content.</span></span>
* <span data-ttu-id="09cd2-151">**内容安全性**。</span><span class="sxs-lookup"><span data-stu-id="09cd2-151">**Content security**.</span></span> <span data-ttu-id="09cd2-152">并非所有 CDN 都针对内容提供了任意形式的访问控制。</span><span class="sxs-lookup"><span data-stu-id="09cd2-152">Not all CDNs offer any form of access control for the content.</span></span> <span data-ttu-id="09cd2-153">某些 CDN 服务（包括 Azure CDN）支持基于令牌的身份验证来保护 CDN 内容。</span><span class="sxs-lookup"><span data-stu-id="09cd2-153">Some CDN services, including Azure CDN, support token-based authentication to protect CDN content.</span></span> <span data-ttu-id="09cd2-154">有关详细信息，请参阅[使用令牌身份验证保护 Azure 内容交付网络资产](/azure/cdn/cdn-token-auth)。</span><span class="sxs-lookup"><span data-stu-id="09cd2-154">For more information, see [Securing Azure Content Delivery Network assets with token authentication](/azure/cdn/cdn-token-auth).</span></span>
* <span data-ttu-id="09cd2-155">**客户端安全性**。</span><span class="sxs-lookup"><span data-stu-id="09cd2-155">**Client security**.</span></span> <span data-ttu-id="09cd2-156">客户端可从不允许访问 CDN 上资源的环境中连接。</span><span class="sxs-lookup"><span data-stu-id="09cd2-156">Clients might connect from an environment that does not allow access to resources on the CDN.</span></span> <span data-ttu-id="09cd2-157">这可能是安全约束的环境，限制只能访问一组已知源，或防止从页来源以外的任何位置加载资源的环境。</span><span class="sxs-lookup"><span data-stu-id="09cd2-157">This could be a security-constrained environment that limits access to only a set of known sources, or one that prevents loading of resources from anything other than the page origin.</span></span> <span data-ttu-id="09cd2-158">需要实施回退才能处理这些情况。</span><span class="sxs-lookup"><span data-stu-id="09cd2-158">A fallback implementation is required to handle these cases.</span></span>
* <span data-ttu-id="09cd2-159">**复原能力**。</span><span class="sxs-lookup"><span data-stu-id="09cd2-159">**Resilience**.</span></span> <span data-ttu-id="09cd2-160">CDN 是应用程序潜在的单个故障点。</span><span class="sxs-lookup"><span data-stu-id="09cd2-160">The CDN is a potential single point of failure for an application.</span></span> 

<span data-ttu-id="09cd2-161">CDN 用处不大的应用场景包括：</span><span class="sxs-lookup"><span data-stu-id="09cd2-161">Scenarios where CDN may be less useful include:</span></span>  

* <span data-ttu-id="09cd2-162">如果内容点击率偏低，则可能表示该内容在有效期（由其生存时间设置确定）只被访问了几次。</span><span class="sxs-lookup"><span data-stu-id="09cd2-162">If the content has a low hit rate, it might be accessed only few times while it is valid (determined by its time-to-live setting).</span></span> 
* <span data-ttu-id="09cd2-163">数据是专用的，例如用于大型企业或供应链生态系统。</span><span class="sxs-lookup"><span data-stu-id="09cd2-163">If the data is private, such as for large enterprises or supply chain ecosystems.</span></span>

## <a name="general-guidelines-and-good-practices"></a><span data-ttu-id="09cd2-164">一般性指导原则和最佳实践</span><span class="sxs-lookup"><span data-stu-id="09cd2-164">General guidelines and good practices</span></span>

<span data-ttu-id="09cd2-165">使用 CDN 是最小化应用程序负载和最大化可用性与性能的良好做法。</span><span class="sxs-lookup"><span data-stu-id="09cd2-165">Using a CDN is a good way to minimize the load on your application, and maximize availability and performance.</span></span> <span data-ttu-id="09cd2-166">考虑为应用程序使用的所有适当内容和资源采用此策略。</span><span class="sxs-lookup"><span data-stu-id="09cd2-166">Consider adopting this strategy for all of the appropriate content and resources your application uses.</span></span> <span data-ttu-id="09cd2-167">设计策略来使用 CDN 时，请注意以下部分中所述的要点。</span><span class="sxs-lookup"><span data-stu-id="09cd2-167">Consider the points in the following sections when designing your strategy to use a CDN.</span></span>

### <a name="deployment"></a><span data-ttu-id="09cd2-168">部署</span><span class="sxs-lookup"><span data-stu-id="09cd2-168">Deployment</span></span>
<span data-ttu-id="09cd2-169">如果未在应用程序部署包或过程中包含静态内容，该静态内容可能需要与应用程序分开设置和部署。</span><span class="sxs-lookup"><span data-stu-id="09cd2-169">Static content may need to be provisioned and deployed independently from the application if you do not include it in the application deployment package or process.</span></span> <span data-ttu-id="09cd2-170">考虑这如何影响版本控制方法，也就是用于管理应用程序组件和静态资源内容的方法。</span><span class="sxs-lookup"><span data-stu-id="09cd2-170">Consider how this will affect the versioning approach you use to manage both the application components and the static resource content.</span></span>

<span data-ttu-id="09cd2-171">考虑使用绑定和缩减技术来为客户端减少加载次数。</span><span class="sxs-lookup"><span data-stu-id="09cd2-171">Consider using bundling and minification techniques to reduce load times for clients.</span></span> <span data-ttu-id="09cd2-172">捆绑将多个文件合并到单个文件中。</span><span class="sxs-lookup"><span data-stu-id="09cd2-172">Bundling combines multiple files into a single file.</span></span> <span data-ttu-id="09cd2-173">缩减在不更改功能的情况下从脚本和 CSS 文件中删除不必要的字符。</span><span class="sxs-lookup"><span data-stu-id="09cd2-173">Minification removes unnecessary characters from scripts and CSS files without altering functionality.</span></span>

<span data-ttu-id="09cd2-174">如果需要将内容部署到其他位置，则这属于部署过程的附加步骤。</span><span class="sxs-lookup"><span data-stu-id="09cd2-174">If you need to deploy the content to an additional location, this will be an extra step in the deployment process.</span></span> <span data-ttu-id="09cd2-175">如果应用程序更新 CDN 的内容（也许是按固定间隔或为了响应事件），则必须将更新的内容存储在任何其他位置以及 CDN 的终结点中。</span><span class="sxs-lookup"><span data-stu-id="09cd2-175">If the application updates the content for the CDN, perhaps at regular intervals or in response to an event, it must store the updated content in any additional locations as well as the endpoint for the CDN.</span></span>

<span data-ttu-id="09cd2-176">当预期要从 CDN 提供某些静态内容时，请考虑你将如何处理本地开发和测试。</span><span class="sxs-lookup"><span data-stu-id="09cd2-176">Consider how you will handle local development and testing when some static content is expected to be served from a CDN.</span></span> <span data-ttu-id="09cd2-177">例如，可以在生成脚本中将内容预先部署到 CDN。</span><span class="sxs-lookup"><span data-stu-id="09cd2-177">For example, you could pre-deploy the content to the CDN as part of your build script.</span></span> <span data-ttu-id="09cd2-178">另外，可以使用汇编指令或标志来控制应用程序如何加载资源。</span><span class="sxs-lookup"><span data-stu-id="09cd2-178">Alternatively, use compile directives or flags to control how the application loads the resources.</span></span> <span data-ttu-id="09cd2-179">例如，在调试模式下，应用程序可以从本地文件夹加载静态资源。</span><span class="sxs-lookup"><span data-stu-id="09cd2-179">For example, in debug mode, the application could load static resources from a local folder.</span></span> <span data-ttu-id="09cd2-180">在发布模式下，应用程序将使用 CDN。</span><span class="sxs-lookup"><span data-stu-id="09cd2-180">In release mode, the application would use the CDN.</span></span>

<span data-ttu-id="09cd2-181">请考虑用于文件压缩的选项，例如 gzip (GNU zip)。</span><span class="sxs-lookup"><span data-stu-id="09cd2-181">Consider the options for file compression, such as gzip (GNU zip).</span></span> <span data-ttu-id="09cd2-182">压缩可以由 Web 应用程序宿主在源服务器上执行，也可以由 CDN 直接在边缘服务器上执行。</span><span class="sxs-lookup"><span data-stu-id="09cd2-182">Compression may be performed on the origin server by the web application hosting or directly on the edge servers by the CDN.</span></span> <span data-ttu-id="09cd2-183">有关详细信息，请参阅[通过在 Azure CDN 中压缩文件来提高性能](/azure/cdn/cdn-improve-performance)。</span><span class="sxs-lookup"><span data-stu-id="09cd2-183">For more information, see [Improve performance by compressing files in Azure CDN](/azure/cdn/cdn-improve-performance).</span></span>


### <a name="routing-and-versioning"></a><span data-ttu-id="09cd2-184">路由和版本控制</span><span class="sxs-lookup"><span data-stu-id="09cd2-184">Routing and versioning</span></span>
<span data-ttu-id="09cd2-185">可能需要在不同的时间使用不同的 CDN 实例。</span><span class="sxs-lookup"><span data-stu-id="09cd2-185">You may need to use different CDN instances at various times.</span></span> <span data-ttu-id="09cd2-186">例如，在部署新版的应用程序时，可能需要使用新的 CDN 并保留以前版本的旧 CDN（以便以旧格式保存内容）。</span><span class="sxs-lookup"><span data-stu-id="09cd2-186">For example, when you deploy a new version of the application you may want to use a new CDN and retain the old CDN (holding content in an older format) for previous versions.</span></span> <span data-ttu-id="09cd2-187">如果将 Azure Blob 存储用作内容来源，可以创建一个独立存储帐户或容器，并将 CDN 终结点指向它。</span><span class="sxs-lookup"><span data-stu-id="09cd2-187">If you use Azure blob storage as the content origin, you can create a separate storage account or a separate container and point the CDN endpoint to it.</span></span> 

<span data-ttu-id="09cd2-188">不要使用查询字符串来表示 CDN 上资源链接中不同版本的应用程序，因为从 Azure Blob 存储检索内容时，查询字符串是资源名称（Blob 名称）的一部分。</span><span class="sxs-lookup"><span data-stu-id="09cd2-188">Do not use the query string to denote different versions of the application in links to resources on the CDN because, when retrieving content from Azure blob storage, the query string is part of the resource name (the blob name).</span></span> <span data-ttu-id="09cd2-189">此方式还会影响客户端缓存资源的方式。</span><span class="sxs-lookup"><span data-stu-id="09cd2-189">This approach can also affect how the client caches resources.</span></span>

<span data-ttu-id="09cd2-190">如果在 CDN 上缓存以前的资源，则在部署新版本的静态内容时更新应用程序可能是一个难题。</span><span class="sxs-lookup"><span data-stu-id="09cd2-190">Deploying new versions of static content when you update an application can be a challenge if the previous resources are cached on the CDN.</span></span> <span data-ttu-id="09cd2-191">有关详细信息，请参阅下文中有关缓存控制的部分。</span><span class="sxs-lookup"><span data-stu-id="09cd2-191">For more information, see the section on cache control, below.</span></span>

<span data-ttu-id="09cd2-192">考虑按国家/地区限制 CDN 内容访问。</span><span class="sxs-lookup"><span data-stu-id="09cd2-192">Consider restricting the CDN content access by country.</span></span> <span data-ttu-id="09cd2-193">Azure CDN 允许根据来源国家/地区筛选请求，并限制传送的内容。</span><span class="sxs-lookup"><span data-stu-id="09cd2-193">Azure CDN allows you to filter requests based on the country of origin and restrict the content delivered.</span></span> <span data-ttu-id="09cd2-194">有关详细信息，请参阅 [Restrict access to your content by country](/azure/cdn/cdn-restrict-access-by-country/)（按国家/地区限制内容访问）。</span><span class="sxs-lookup"><span data-stu-id="09cd2-194">For more information, see [Restrict access to your content by country](/azure/cdn/cdn-restrict-access-by-country/).</span></span>

### <a name="cache-control"></a><span data-ttu-id="09cd2-195">缓存控制</span><span class="sxs-lookup"><span data-stu-id="09cd2-195">Cache control</span></span>
<span data-ttu-id="09cd2-196">考虑如何管理系统中的缓存。</span><span class="sxs-lookup"><span data-stu-id="09cd2-196">Consider how to manage caching within the system.</span></span> <span data-ttu-id="09cd2-197">例如，在 Azure CDN 中，可以设置全局缓存规则，然后为特定的源终结点设置自定义缓存。</span><span class="sxs-lookup"><span data-stu-id="09cd2-197">For example, in Azure CDN, you can set global caching rules, and then set custom caching for particular origin endpoints.</span></span> <span data-ttu-id="09cd2-198">可以通过在源终结点发送缓存指令标头来控制如何在 CDN 中执行缓存。</span><span class="sxs-lookup"><span data-stu-id="09cd2-198">You can also control how caching is performed in a CDN by sending cache-directive headers at the origin.</span></span> 

<span data-ttu-id="09cd2-199">有关详细信息，请参阅[缓存工作原理](/azure/cdn/cdn-how-caching-works)。</span><span class="sxs-lookup"><span data-stu-id="09cd2-199">For more information, see [How caching works](/azure/cdn/cdn-how-caching-works).</span></span>

<span data-ttu-id="09cd2-200">要防止对象在 CDN 上可用，可以从来源中删除这些对象、移除或删除 CDN 终结点，或者在使用 Blob 存储的情况下，将容器或 Blob 设为专用的。</span><span class="sxs-lookup"><span data-stu-id="09cd2-200">To prevent objects from being available on the CDN, you can delete them from the origin, remove or delete the CDN endpoint, or in the case of blob storage, make the container or blob private.</span></span> <span data-ttu-id="09cd2-201">但是，在生存时间到期之前，不会将项移除。</span><span class="sxs-lookup"><span data-stu-id="09cd2-201">However, items are not removed from the until the time-to-live expires.</span></span> <span data-ttu-id="09cd2-202">还可以手动清除 CDN 终结点。</span><span class="sxs-lookup"><span data-stu-id="09cd2-202">You can also manually purge a CDN endpoint.</span></span>

### <a name="security"></a><span data-ttu-id="09cd2-203">“安全”</span><span class="sxs-lookup"><span data-stu-id="09cd2-203">Security</span></span>

<span data-ttu-id="09cd2-204">CDN 可以使用 CDN 提供的证书通过 HTTPS (SSL) 传送内容，也可以通过标准 HTTP 传送内容。</span><span class="sxs-lookup"><span data-stu-id="09cd2-204">The CDN can deliver content over HTTPS (SSL), by using the certificate provided by the CDN, as well as over standard HTTP.</span></span> <span data-ttu-id="09cd2-205">若要避免浏览器发出有关内容混合的警告，可能需要使用 HTTPS 来请求通过 HTTPS 加载的页面所显示的静态内容。</span><span class="sxs-lookup"><span data-stu-id="09cd2-205">To avoid browser warnings about mixed content, you might need to use HTTPS to request static content that is displayed in pages loaded through HTTPS.</span></span>

<span data-ttu-id="09cd2-206">使用 CDN 传送静态资产（如字体文件）时，如果使用 XMLHttpRequest 调用来从不同的域请求这些资源，则可能会遇到同源策略问题。</span><span class="sxs-lookup"><span data-stu-id="09cd2-206">If you deliver static assets such as font files by using the CDN, you might encounter same-origin policy issues if you use an *XMLHttpRequest* call to request these resources from a different domain.</span></span> <span data-ttu-id="09cd2-207">许多 Web 浏览器会阻止跨源资源共享 (CORS)，除非 Web 服务器已配置为设置相应的响应标头。</span><span class="sxs-lookup"><span data-stu-id="09cd2-207">Many web browsers prevent cross-origin resource sharing (CORS) unless the web server is configured to set the appropriate response headers.</span></span> <span data-ttu-id="09cd2-208">可使用以下任一方法配置 CDN 以支持 CORS：</span><span class="sxs-lookup"><span data-stu-id="09cd2-208">You can configure the CDN to support CORS by using one of the following methods:</span></span>

* <span data-ttu-id="09cd2-209">对 CDN 进行配置来将 CORS 标头添加到响应。</span><span class="sxs-lookup"><span data-stu-id="09cd2-209">Configure the CDN to add CORS headers to the responses.</span></span> <span data-ttu-id="09cd2-210">有关详细信息，请参阅[将 Azure CDN 与 CORS 一起使用](/azure/cdn/cdn-cors)。</span><span class="sxs-lookup"><span data-stu-id="09cd2-210">For more information, see [Using Azure CDN with CORS](/azure/cdn/cdn-cors).</span></span> 
* <span data-ttu-id="09cd2-211">如果源是 Azure blob 存储，请将 CORS 规则添加到存储终结点。</span><span class="sxs-lookup"><span data-stu-id="09cd2-211">If the origin is Azure blob storage, add CORS rules to the storage endpoint.</span></span> <span data-ttu-id="09cd2-212">有关详细信息，请参阅 [Cross-Origin Resource Sharing (CORS) Support for the Azure Storage Services](http://msdn.microsoft.com/library/azure/dn535601.aspx)（Azure 存储服务的跨域资源共享 (CORS) 支持）。</span><span class="sxs-lookup"><span data-stu-id="09cd2-212">For more information, see [Cross-Origin Resource Sharing (CORS) Support for the Azure Storage Services](http://msdn.microsoft.com/library/azure/dn535601.aspx).</span></span>
* <span data-ttu-id="09cd2-213">对应用程序进行配置来设置 CORS 标头。</span><span class="sxs-lookup"><span data-stu-id="09cd2-213">Configure the application to set the CORS headers.</span></span> <span data-ttu-id="09cd2-214">有关示例，请参阅 ASP.NET Core 文档中的[启用跨源请求 (CORS)](/aspnet/core/security/cors)。</span><span class="sxs-lookup"><span data-stu-id="09cd2-214">For example, see [Enabling Cross-Origin Requests (CORS)](/aspnet/core/security/cors) in the ASP.NET Core documentation.</span></span>

### <a name="cdn-fallback"></a><span data-ttu-id="09cd2-215">CDN 回退</span><span class="sxs-lookup"><span data-stu-id="09cd2-215">CDN fallback</span></span>
<span data-ttu-id="09cd2-216">考虑应用程序如何处理 CDN 失败或暂时不可用的情况。</span><span class="sxs-lookup"><span data-stu-id="09cd2-216">Consider how your application will cope with a failure or temporary unavailability of the CDN.</span></span> <span data-ttu-id="09cd2-217">如果 CDN 不可用，客户端应用程序可以使用执行前面请求期间的本地缓存资源的副本（位于客户端），或者可以添加代码来检测失败，而不是从来源请求资源（应用程序文件夹或保留资源的 Azure Blob 容器）。</span><span class="sxs-lookup"><span data-stu-id="09cd2-217">Client applications may be able to use copies of the resources that were cached locally (on the client) during previous requests, or you can include code that detects failure and instead requests resources from the origin (the application folder or Azure blob container that holds the resources) if the CDN is unavailable.</span></span>
